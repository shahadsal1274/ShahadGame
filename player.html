<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ†Ø² Ù…Ø¹ Ø´Ù‡Ø¯</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap&subset=arabic" rel="stylesheet">
<style>
body { font-family:"Baloo 2", cursive; background:#e0f0ff; text-align:center; padding:10px;}
h1,h2{color:#2c4a6e;}
select,button,input{width:90%;max-width:320px;padding:10px;margin:8px auto;border-radius:10px;border:none;font-size:16px;}
button{background:#4a90e2;color:white;cursor:pointer;transition:0.2s;}
button:hover{transform:scale(1.05);background:#357ABD;}
.optionBtn{display:block;margin:10px auto;padding:10px;background:#6fa8dc;color:white;border-radius:8px;transition:0.2s;}
.optionBtn:hover{background:#5596c3;transform:scale(1.05);}
#waitingScreen,#countdownScreen,#gameArea{display:none;margin-top:20px;}
#countdown{font-size:60px;color:#357ABD;margin-top:40px;}
#hintText{margin-top:10px;font-weight:bold;color:#006400;}
#progressDisplay{margin-top:10px;font-weight:bold;color:#2c4a6e;}
#codeContainer{display:none;margin-top:10px;}
#endMessage{font-size:1.2em;color:#2c4a6e;margin-top:20px;}
</style>
</head>
<body>

<h1> Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ†Ø² Ù…Ø¹ Ø´Ù‡Ø¯</h1>

<div id="teamSelection">
  <h2>Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ùƒ</h2>
  <select id="teamSelect">
    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ±ÙŠÙ‚ --</option>
  </select>
</div>

<div id="waitingScreen">â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø´ÙŠØ®Ø© Ø§Ù„Ø´ÙŠØ®Ø§Øª  Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ù‡...</div>

<div id="countdownScreen">
  <div id="countdown">3</div>
</div>

<div id="gameArea">
  <div>Ø§Ù„ÙØ±ÙŠÙ‚: <span id="playerTeamName"></span> | Ø§Ù„ÙˆÙ‚Øª: <span id="timeDisplay">0:00</span></div>
  <h2 id="questionText"></h2>
  <div id="optionsContainer"></div>
  <div id="hintText"></div>
  <div id="codeContainer">
    <input type="text" id="codeInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯">
    <button id="checkCodeBtn">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯</button>
  </div>
  <div id="progressDisplay"></div>
</div>

<audio id="startSound"><source src="start.mp3" type="audio/mpeg"></audio>
<audio id="correctSound"><source src="correct.mp3" type="audio/mpeg"></audio>
<audio id="wrongSound"><source src="wrong.mp3" type="audio/mpeg"></audio>
<audio id="winSound"><source src="win.mp3" type="audio/mpeg"></audio>

<script>
let stages = JSON.parse(localStorage.getItem("stages")) || [];
let teams = JSON.parse(localStorage.getItem("teams")) || [];
let playerTeam = localStorage.getItem("playerTeam") || "";
let currentStage = parseInt(localStorage.getItem("stage-" + playerTeam)) || 0;
let timerInterval = null;

const teamSelect = document.getElementById("teamSelect");
const waitingScreen = document.getElementById("waitingScreen");
const countdownScreen = document.getElementById("countdownScreen");
const countdownElem = document.getElementById("countdown");
const gameArea = document.getElementById("gameArea");
const codeContainer = document.getElementById("codeContainer");

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ±Ù‚ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
teams.forEach(team => {
  const opt = document.createElement("option");
  opt.value = team;
  opt.textContent = team;
  teamSelect.appendChild(opt);
});

// Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯ ÙØ±ÙŠÙ‚ Ø³Ø§Ø¨Ù‚ØŒ Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø¨Ø§Ø´Ø±Ø©
if(playerTeam){
  teamSelect.parentElement.style.display = "none";
  document.getElementById("playerTeamName").textContent = playerTeam;
  if(!gameStarted()) waitingScreen.style.display="block";
  else startCountdown();
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
function gameStarted() {
  return localStorage.getItem("gameStarted") === "yes" && localStorage.getItem("startTime") !== null;
}

// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±ÙŠÙ‚
teamSelect.addEventListener("change",()=>{
  if(!teamSelect.value) return;
  playerTeam = teamSelect.value;
  localStorage.setItem("playerTeam",playerTeam);
  document.getElementById("playerTeamName").textContent = playerTeam;
  currentStage = parseInt(localStorage.getItem("stage-" + playerTeam)) || 0;
  teamSelect.parentElement.style.display = "none";
  waitingScreen.style.display = "block";
});

// Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ Ù†ØµÙ Ø«Ø§Ù†ÙŠØ© Ø¥Ø°Ø§ Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø§Ø³ØªØ± Ø§Ù„Ù„Ø¹Ø¨Ø©
setInterval(()=>{
  if(playerTeam && gameStarted() && !timerInterval){
    waitingScreen.style.display = "none";startCountdown();
  }
},500);

function startCountdown(){
  countdownScreen.style.display = "block";
  let count=3;
  countdownElem.textContent=count;
  const interval=setInterval(()=>{
    count--;
    if(count===0){
      clearInterval(interval);
      countdownScreen.style.display="none";
      document.getElementById("startSound").play();
      startGame();
    } else countdownElem.textContent=count;
  },1000);
}

function startGame(){
  gameArea.style.display="block";
  const startTime=parseInt(localStorage.getItem("startTime"));
  timerInterval=setInterval(()=>{
    const sec=Math.floor((Date.now()-startTime)/1000);
    document.getElementById("timeDisplay").textContent=
      Math.floor(sec/60)+":"+(sec%60<10?"0"+sec:sec%60);
    localStorage.setItem("time-"+playerTeam,sec);
    document.getElementById("progressDisplay").textContent="Ø§Ù„Ù…Ø±Ø­Ù„Ø© "+currentStage;
  },1000);
  showStage();
}

function showStage() {
  if(currentStage >= stages.length) { 
    // Ø¢Ø®Ø± Ù…Ø±Ø­Ù„Ø©: ÙÙ‚Ø· ØªÙ„Ù…ÙŠØ­ Ù…ÙƒØ§Ù† Ø§Ù„ÙƒÙ†Ø²
    document.getElementById("questionText").textContent = "ğŸ¯ ØªÙ„Ù…ÙŠØ­ Ù…ÙƒØ§Ù† Ø§Ù„ÙƒÙ†Ø²: " + stages[stages.length-1].hints.easy;
    document.getElementById("optionsContainer").innerHTML = "";
    codeContainer.style.display = "none"; // Ù†Ø®ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„ÙƒÙˆØ¯
    document.getElementById("hintText").textContent = "";
    return;
  }

  const stage = stages[currentStage];
  document.getElementById("questionText").textContent = stage.question;
  document.getElementById("hintText").textContent = "";
  codeContainer.style.display = "none";
  document.getElementById("codeInput").value = "";

  const cont = document.getElementById("optionsContainer");
  cont.innerHTML = "";
  stage.options.forEach((opt, i) => {
    const btn = document.createElement("button");
    btn.className = "optionBtn";
    btn.textContent = opt;
    btn.onclick = () => {
      document.getElementById("hintText").textContent =
        (i+1 === stage.answer ? "âœ”ï¸ " + stage.hints.easy : "âŒ " + stage.hints.hard);
      codeContainer.style.display = "block";
      if(i+1 === stage.answer) document.getElementById("correctSound").play();
      else document.getElementById("wrongSound").play();
    };
    cont.appendChild(btn);
  });
}

document.getElementById("checkCodeBtn").onclick=()=>{
  const stage=stages[currentStage];
  const codeInput=document.getElementById("codeInput").value.trim();
  if(codeInput===stage.codes[playerTeam]){
    currentStage++;
    localStorage.setItem("stage-"+playerTeam,currentStage);
    showStage();
    if(currentStage>=stages.length) document.getElementById("winSound").play();
  } else alert("Ø§Ù„ÙƒÙˆØ¯ Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©!");
};

function endGame(){
  clearInterval(timerInterval);
  const totalSec=parseInt(localStorage.getItem("time-"+playerTeam))||0;
  const minutes=Math.floor(totalSec/60);
  const seconds=totalSec%60;
  const endDiv=document.createElement("div");
  endDiv.id="endMessage";
  endDiv.textContent=`ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø§Ù„ÙØ±ÙŠÙ‚ ${playerTeam} ÙˆØµÙ„ Ø§Ù„ÙƒÙ†Ø² Ø®Ù„Ø§Ù„ ${minutes} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ${seconds} Ø«Ø§Ù†ÙŠØ© ğŸ‰`;
  document.body.appendChild(endDiv);
}
</script>
</body>

</html>
